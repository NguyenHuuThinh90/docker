pipeline {
    agent any
	// Environment 
    environment {
		fileTarget = 'demo.war'
        MAVEN_PATH = 'k8e-jk-git/pom.xml'
		mvnDir = '/var/jenkins_home/tools_jk/apache-maven-3.6.1/bin/'
		targetDir = 'k8e-jk-git/target/${fileTarget}'
		destinationDir = '../../tools_jk/build/'

    }
	// Declare global config tool
	tools {
		jdk 'jdk11' 
		maven 'maven361'
	}
	// Check version
    stages {
		stage('test-version') {
			steps {
				script {
					try {
						echo "parameter select ${params.envir}"
						sh "java -version"
						sh "mvn -version"
					} catch (err) {
						echo err.getMessage()
						echo "No detect version"
					}
				}
			}
		}
		stage('Clean') {
			steps {
				echo "${mvnDir}"
				sh "${mvnDir}mvn -f ${MAVEN_PATH} clean"
			}
		}
        stage('Build') {
            steps {
				sh "${mvnDir}mvn -f ${MAVEN_PATH} install"
            }
            post {
                success {
                    echo "BUILD DONE"
                }
            }
        }
		stage('Copy') {
            steps {
				echo "Target folder: ${targetDir}"
				echo "Destination folder: ${destinationDir}"
				sh "mv ${targetDir} ${destinationDir}"
            }
            post {
                success {
                    echo "COPY DONE"
                }
            }
        }
    }
}
